---
title: NPF法则推导
date: 2020-06-06 13:20:43
tags: 键盘摄影师
---

# 涉及知识

数学：弧度制；三角函数

物理/地理：凸透镜成像（初中）；光的衍射（艾里斑）

摄影：光圈定义

# 公式推导

诸位拍星空，有两个问题要问问自己：~~别问。问就是“混！混混！”~~ 星星在CMOS上成的像有多大？星星的像运动得多快？

理想状态下，按照凸透镜成像的原理，无穷远处的物体会在焦点处成一个无穷小的像。要是真的这样这篇文章就不用写了，反正怎么拍都拍不出圆的星星，永远都能看到星星的拖影。现实情况中，大气散射和光的衍射等情况的存在，都会让星星的像从无穷小的点变成一堆像素点，这才创造了长时间曝光的机会。NPF法则主要考虑散射、衍射和去马赛克处理三个因素，认为星星的像的直径由**可视直径**、**艾里斑直径**和**CMOS像素间距**三部分构成。

**可视直径**是由于大气散射造成的。当我们讨论天体可视直径的时候，一般通过可视角度（或“视角”）来讨论，可视角度即星星顶端到眼睛的连线与星星底端到眼睛连线的夹角。以太阳为例，太阳直径为1.4×10^6千米，而日地距离为1.45×10^8千米，那么太阳的理论视角就是0.01弧度，即0.57度。但是由于大气的存在，太阳的视角会发生变化，就像两小儿辩日一样，早上视角大，看起来大；中午视角小，看起来小。

![视角](fig1.png)

fig 1 视角

对于星星来说，视角主要由天气，天气好的时候，最小可以达到0.3''(1°=3600'')，空气条件不佳时会高达4''。通过简单的几何关系，就可以计算出CMOS上像的可视直径。以16mm的物理焦距为例，星星的可视直径大约在20~300nm之间。

![视角](fig2.png)

fig 2 可视直径

**艾里斑**是由于光的衍射造成的一种现象。由于光具有电磁波的特性，所以光在通过狭缝时，会发生衍射，偏离直线传播，在远场形成明暗相间的同心圆，而非一个点。其中中心亮斑占了84%的亮度，第一个亮环占了7%的亮度，剩余9%的亮度分布在外围其他亮环中。

![艾里斑](fig3.png)

fig 3 艾里斑

在光学仪器中，由于衍射的存在，光线无法汇聚到一点，只能在该点附近形成一个艾里斑，所以看到的像实际上是无数微小的艾里斑的组成的模糊图案。艾里斑的在CMOS上的直径在几百纳米左右，拍摄普通物体时，可以忽略不计。但是在极端领域，这个尺寸被认为是光学分辨的极限。在摄影中，艾里斑的直径由光圈（即焦距与镜头孔径的比值）和光的波长共同决定，NPF法则考虑了将艾里斑的直径定义为第一个亮环的直径，以绿光为例，当光圈为F3.5时，艾里斑的直径为8μm，比前面的几百纳米的像大多了。

![d_airy](fig4.png)

fig 4 艾里斑直径

最后一个影响成像大小的是CMOS上的像素点**间距**。现在相机的CMOS都使用拜耳阵列，即四个像素点为一组，其中一个点感应红色，一个点感应蓝色，两个点感应绿色（或者黄色）。再通过去马赛克计算，反推出原有信息。由于计算的过程中2×2一组进行处理，所以边缘会进一步模糊，模糊的直径为两倍的像素点尺寸。以索大法APS-C相机为例，像素点的尺寸约为4μm，所以直径进一步增加8μm；在全画幅的A7R3中，像素点尺寸约为4.5μm，像素点直径进一步增加9μm。

![bayer](fig5.png)

fig 5 拜耳阵列

# 参考资料

NPF法则：http://www.sahavre.fr/tutoriels/astrophoto/34-regle-npf-temps-de-pose-pour-eviter-le-file-d-etoiles （法语，建议机翻成英语食用）

艾里斑：https://www.guokr.com/article/49548/