# 星空摄影中的500法则与NPF法则|键摄的自我修养

在星空摄影中，通常使用长时间曝光的方式提高进光量，当曝光时间过长时，由于地球自转，星星会发生移动，从而出现星轨。在拍摄星野的过程中，通常会使用500法则或者NPF法则确定最长曝光时间。在500法则中，最长曝光时间为500/焦距，也有玄学因素认为应该根据纬度选择分子，高维度用600法则，低维度用400法则。而NPF法则的简化公式认为需要根据焦距f、光圈N和像素尺寸p计算，公式为(35N+30p)/f。

![0](./fig/fig0.png)

那么在实际拍摄中到底应该以哪个公式为准？NPF法则为何这么复杂？本键盘摄影师发现目前还很难找到这方面的中文资料，就做一个知识的搬运工，从法语资料把这些内容整理成中文。

##太长不看版

1. 500法则是胶片摄影时代的经验公式，现在选NPF法则更准确。
2. NPF法则的最长曝光时间对赤纬敏感，最大能差两倍。
3. 相机朝北拍摄的时候结果接近与300法则或者400法则，朝南拍摄需要除2。（北温带）
4. 手机朝北拍摄接近100法则，朝南拍摄依旧除2，焦距需要使用物理焦距（4mm左右）。
5. 费这么大劲算参数不如直接从30秒开始二分法尝试。

## 长文推导

### 涉及知识

数学：弧度制；三角函数

物理/地理：凸透镜成像（初中）；光的衍射（艾里斑）

摄影：光圈定义

### 公式推导

诸位拍星空，有两个问题要问问自己：~~别问。问就是“混！混混！”~~ 星星在CMOS上成的像有多大？星星的像运动得多快？

理想状态下，按照凸透镜成像的原理，无穷远处的物体会在焦点处成一个无穷小的像。要是真的这样这篇文章就不用写了，反正怎么拍都拍不出圆的星星，永远都能看到星星的拖影。现实情况中，大气散射和光的衍射等情况的存在，都会让星星的像从无穷小的点变成一堆像素点，这才创造了长时间曝光的机会。NPF法则主要考虑散射、衍射和去马赛克处理三个因素，认为星星的像的直径由**可视直径**、**艾里斑直径**和**CMOS像素间距**三部分构成。

#### 大气散射

**可视直径**是由于大气散射造成的。当我们讨论天体可视直径的时候，一般通过可视角度（或“视角”）来讨论，可视角度即星星顶端到眼睛的连线与星星底端到眼睛连线的夹角。以太阳为例，太阳直径为1.4×10^6千米，而日地距离为1.45×10^8千米，那么太阳的理论视角就是0.01弧度，即0.57度。但是由于大气的存在，太阳的视角会发生变化，就像两小儿辩日一样，早上视角大，看起来大；中午视角小，看起来小。

![视角](./fig/fig1.png)

fig 1 视角

对于星星来说，视角主要由天气，天气好的时候，最小可以达到0.3''(1°=3600'')，空气条件不佳时会高达4''。通过简单的几何关系，就可以计算出CMOS上像的可视直径。以16mm的物理焦距为例，星星的可视直径大约在20~300nm之间。

![视角](./fig/fig2.png)

fig 2 可视直径

#### 艾里斑

**艾里斑**是由于光的衍射造成的一种现象。由于光具有电磁波的特性，所以光在通过狭缝时，会发生衍射，偏离直线传播，在远场形成明暗相间的同心圆，而非一个点。其中中心亮斑占了84%的亮度，第一个亮环占了7%的亮度，剩余9%的亮度分布在外围其他亮环中。

![艾里斑](./fig/fig3.png)

fig 3 艾里斑

在光学仪器中，由于衍射的存在，光线无法汇聚到一点，只能在该点附近形成一个艾里斑，所以看到的像实际上是无数微小的艾里斑的组成的模糊图案。艾里斑的在CMOS上的直径在几百纳米左右，拍摄普通物体时，可以忽略不计。但是在极端领域，这个尺寸被认为是光学分辨的极限。在摄影中，艾里斑的直径由光圈（即焦距与镜头孔径的比值）和光的波长共同决定，NPF法则考虑了将艾里斑的直径定义为第一个亮环的直径，以绿光为例，当光圈为F3.5时，艾里斑的直径为8μm，比前面的几百纳米的像大多了。

![d_airy](./fig/fig4.png)

fig 4 艾里斑直径

#### 拜耳阵列

最后一个影响成像大小的是CMOS上的像素点**间距**。现在相机的CMOS都使用拜耳阵列，即四个像素点为一组，其中一个点感应红色，一个点感应蓝色，两个点感应绿色（或者黄色）。再通过去马赛克计算，反推出原有信息。由于计算的过程中2×2一组进行处理，所以边缘会进一步模糊，模糊的直径为两倍的像素点尺寸。以索大法APS-C相机为例，像素点的尺寸约为4μm，所以直径进一步增加8μm；在全画幅的A7R3中，像素点尺寸约为4.5μm，像素点直径进一步增加9μm。

![bayer](./fig/fig5.png)

fig 5 拜耳阵列

到这里就回答了第一个问题，星星在CMOS上的成像直径约在10μm到20μm之间，具体公式为

![d_image](./fig/fig6.png)

#### 移动速度

那么星星的运动速度多快呢？大家在北半球拍星轨都有经验，随着地球的自传，北极星几乎静止，而其他的星星绕北极星形成同心圆，离北极星越远，星星运动越快。在天文学中，赤经和赤纬被用于定位星星在天球上的位置，以地球为参照物，整个天球都在绕地球旋转。在地球上看来，正对赤道的星星（赤纬为0°）每天视角转过360°，可视角速度大约为15''/s，随着赤纬的提高，星星的可视角速度逐渐减小，而北极星的视角始终不变，可视角速度为0。由此就能计算出星星的像的运动速度。以16mm焦距为例，星星的像的运动速度大约为1μm/s。

![v](./fig/fig7.png)

#### 曝光时间

当两个圆靠的很近的时候，就可以认为是一个圆。但是多近才算一个圆？这里需要一个基准。NPF法则中，这个基准被设置为像的半径，所以曝光时间的最终表达式为

![final](./fig/fig8.png)

一般情况下，考虑星星视角θ≈3''，平均波长λ≈550nm，公式可以近似成

![approx1](./fig/fig9.png)

继续近似，假设平均赤纬为60°，那么就可以进一步简化成度娘随处可见的形式

![approx2](./fig/fig10.png)

如果使用800万像素的全画幅相机搭配F5.6光圈的镜头，那么分母恰好为500，符合500法则。

### 敏感参数

如果仔细看完整公式，一些参数其实不太重要。

![full](./fig/fig11.png)

可视角度是最不重要的参数，尽管上面的公式是在可视角度为3''时的结果，但是f前面的系数还是只有0.1，分子第一项的数值远远小于后两项，如果天气理想，这个数还能更小，几乎可以忽略不计。

像素间距p是由相机决定的，目前相机主流CMOS的像素尺寸在4-6μm之间，这一项大约会引起20%的偏差。

赤纬δ是一个非常重要的参数，但这个参数偏偏又消失在最常见的经验公式里面。拍摄星空一般会用较大的视角，以60度为例（等效焦距约35mm），当镜头正对北极星时，能拍到的最低赤纬是(90°-60°/2)=60°，此时cosδ=0.5，即和简化公式相同。但是以笔者所在北纬30度为例，当镜头正对天顶时，能拍到的最低赤纬为(30°-60°/2)=0°，此时cosδ=1。和简化公式相差了两倍。如果用广角或者朝南拍摄，就非常容易拍到0°赤纬的星星，这时最长曝光时间相比拍摄北极星几乎减少了一半！

焦距和光圈是拍摄时候选择的自变量，仔细看推导过程可以发现，所有计算过程都使用了绝对尺寸，所以这里使用的焦距是物理焦距而非等效焦距。对于相机而言，半幅 和全画幅会有一定区别。

对于手机来说，各项数值的相对大小会发生很大的变化。手机镜头宣传的焦距都是等效焦距，CMOS大小不一，小到水果厂祖传1/2.55英寸，大到菊厂1/1.28英寸，实际焦距和等效焦距相差了好几倍。但是受限于手机的物理厚度，主摄焦距一般在4mm左右。手机CMOS的像素尺寸也小于相机，一般在1-2μm左右，但是光圈普遍大，在F2.0左右。在手机中，拍摄北极星时最接近的经验公式应该是100法则。

##参考资料

NPF法则：http://www.sahavre.fr/tutoriels/astrophoto/34-regle-npf-temps-de-pose-pour-eviter-le-file-d-etoiles （法语，建议机翻成英语食用）

艾里斑：https://www.guokr.com/article/49548/
